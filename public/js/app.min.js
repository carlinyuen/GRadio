var socket=io.connect(window.location.href),app=app||{};$(function(){function getParam(key,source){var result=new RegExp(key+"=([^&]*)","i").exec(source?source:window.location.search);return result&&unescape(result[1])||""}function changeStation(sourceUrl){console.log("changeStation:",sourceUrl),$player[0].pause(),$("source").remove(),$.each(sourceUrl.split(","),function(index,source){source&&source.length&&$(document.createElement("source")).attr("src",source).attr("type","audio/mpeg").prependTo($player)}),$player[0].load(),$player[0].play()}var $inputField=$("#input"),$messages=$("#messages"),$sendButton=$("#send"),$player=$("#player");$("li a").click(function(event){event.preventDefault(),console.log("clicked:",this);var href=$(this).attr("href");console.log("href:",href);var newSource=getParam("source",href);console.log("param:",newSource),changeStation(newSource)}),socket.on("message",function(data){$(document.createElement("p")).text(data.msg).appendTo($messages),$messages.scrollTop($messages[0].scrollHeight-$messages.height())}),$sendButton.click(function(){var message=$inputField.val();message.length&&socket.emit("message",{msg:message},function(){$inputField.val("")})}),$inputField.keydown(function(e){13==e.keyCode&&$sendButton.trigger("click")});var source=getParam("source");source?(console.log("onload source:",source),changeStation(source)):$("li a").get(0).click()});